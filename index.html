<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Osler Wellness — POS & Stock (Scaffold)</title>
  <style>
    :root { color-scheme: dark; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#0b1220; color:#e6edf3; }
    header { padding: 16px 20px; border-bottom: 1px solid #1f2a44; display:flex; gap:12px; align-items:center; }
    img.logo { height: 28px; opacity:.9 }
    main { padding: 20px; max-width: 920px; margin: 0 auto; }
    code, pre { background:#0f172a; padding: 2px 6px; border-radius: 6px; }
    .card { border:1px solid #1f2a44; border-radius:14px; padding:16px; margin:16px 0; background:#0d1426; }
    .ok { color:#7ee787; }
    .warn { color:#f1e05a; }
    .bad { color:#ff7b72; }
    button { background:#00c389; color:#05121b; border:none; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <img class="logo" src="./osler-wellness.webp" alt="Osler Wellness" />
    <div>Osler Wellness — POS & Stock</div>
  </header>
  <main>
    <div class="card">
      <h3>Site is live ✅</h3>
      <p>This minimal page confirms Netlify is serving your site and can be embedded in Plato.</p>
      <ul>
        <li>Test env function: <button id="btnEnv">/.netlify/functions/env</button></li>
        <li>Detected Plato token (query <code>?token=</code>): <code id="tok">(none)</code></li>
        <li>Detected patient id (from Plato URL): <code id="pid">(none)</code></li>
      </ul>
      <pre id="out"></pre>
    </div>
    <div class="card">
      <h3>Next step</h3>
      <p>Replace this <code>index.html</code> with your full UI when ready. Keep the folder structure and <code>netlify.toml</code>.</p>
    </div>
  </main>
  <script>
    const qs = new URLSearchParams(location.search);
    const token = qs.get('token') || '(none)';
    document.getElementById('tok').textContent = token.length>20? token.slice(0,20)+'…' : token;
    // Try to derive patient id from Plato's parent URL if embedded:
    try {
      const href = (window.top === window ? window.location.href : window.top.location.href);
      const m = href.match(/\/patients\/(\w+)/);
      document.getElementById('pid').textContent = m ? m[1] : '(none)';
    } catch(e) {
      document.getElementById('pid').textContent = '(sandboxed)';
    }
    document.getElementById('btnEnv').onclick = async () => {
      const r = await fetch('/.netlify/functions/env');
      const j = await r.json();
      document.getElementById('out').textContent = JSON.stringify(j, null, 2);
    };
  </script>
</body>
</html>
